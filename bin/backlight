#!/bin/bash

set -eu

USAGE="$0: < inc | dec | set > [ value ]"
TARGET="/sys/class/backlight/amdgpu_bl0/brightness"
CURRENT="$(cat "${TARGET}")"
DEFAULT_INC=20

if [[ $# -lt 1 || $# -gt 2 ]]
then
    echo "$USAGE" >&2
    exit 1
fi

case "$1" in
    "inc")
        # shellcheck disable=SC2116,SC2004
        BRIGHTNESS="$(echo $((${2:-$DEFAULT_INC} + $CURRENT)))"
        ;;
     "dec")
        # shellcheck disable=SC2116,SC2004
        BRIGHTNESS="$(echo "$(($CURRENT - ${2:-$DEFAULT_INC}))")"
        ;;
     "set")
         if [[ $# -ne 2 ]]
         then
            echo "You need to provide a value to set" >&2
            exit 1
         fi

         BRIGHTNESS="$2"
         ;;
     "get")
         echo "$CURRENT"
         exit 0
         ;;
        *)
         echo "Invalid command: '$1'" >&2
         exit 1
         ;;
 esac

if [[ "$BRIGHTNESS" -le 0 ]]
then
    echo "Brightness: $BRIGHTNESS, is too low" >&2
    exit 1
fi

echo "${BRIGHTNESS}" > "${TARGET}"
